# Indorphins App

[![Indorphins](https://circleci.com/gh/indorphins/app.svg?style=shield&circle-token=0247954f6bd2949f393c5e61054a6d4661cde2f7)](https://app.circleci.com/pipelines/github/indorphins/app)

React based video chat application for [Indoorphins.fit](https://indoorphins.fit).

## Setup

This app depends on the [Indorphins API](https://github.com/indorphins/api) backend when using a config file that goes against a local environment. Take a look at the config folder and some of the files for more info. Developers should create a custom local environment for app development.

Set the app config env var.

```
export APP_ENV=dev
```

Install dependencies.

```
npm i
```

## Run

Run the app in the development mode.

```
npm start
```

Open [http://localhost:3000](http://localhost:3000) to view it in the browser.

## Production Build

Tested and builds against Node v14.12. Bundled with webpack and using the `webpack.config.js` as the build settings.

The app depends on the application config being deployed at the site root as `config.js`. The html template for the site index file generated by webpack loads that script file in the head and uses the global variable to define the application environment. The config file is not generated or copied as part of the build process, and so needs to be deployed manually to any live environment for config changes.

### Create

```
npm i
npm i -g webpack webpack-cli
webpack --config webpack.config.js
```

Webpack should be installed globally to avoid conflicts with the version which create react app requires. Create react app won't coexist with multiple webpack versions installed in the project.

The build process will generate a `build` folder with the necessary site assets. JS files are gzipped for compression and thus cannot be read with a text editor. The js bundles are broken into multiple files to minimize first page load time, and loaded as needed by the application at request time.

| Note: gzipped content needs to be served with a **Content-Encoding: gzip** header for browsers to decode the content properly

### CICD

Builds deploy automatically to develop and production environments through CircleCI. All releases require a tagged version and pull request to either the develop or master branch depending on the target environment.

Circleci builds using docker containers and some of the commands in the `.circleci/config.yml` file may be helpful if wanting to generate a local build that's pretty much identical to a production build as made by the CICD process.

To build using docker (taken from circleci config):

```
docker run --rm -it -v $(pwd):/var/app -w /var/app node:14.1 /bin/bash -c "npm i && npm i -g webpack webpack-cli && webpack --config webpack.config.js"
```